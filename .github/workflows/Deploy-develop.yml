name: Deploy Develop
run-name: ${{ github.actor }} Deploy Develop ðŸš€

on:
  workflow_dispatch

jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸŽ¯ Checkout current branch
        uses: actions/checkout@v3
        with:
          ref: develop
          fetch-depth: 1

      - name: ðŸ›  install Envoy
        run: |
          rm composer.*
          composer require laravel/envoy

      - name: âš™ Config SSH
        run: |
          eval $(ssh-agent -s)
          mkdir -p ~/.ssh
          echo "${SSH_PRIVATE_KEY_HOSTGATOR}" > ~/.ssh/id_rsa
          chmod 400 ~/.ssh/id_rsa
          ssh-add ~/.ssh/id_rsa
          echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config
        env:
          SSH_PRIVATE_KEY_HOSTGATOR: ${{secrets.SSH_PRIVATE_KEY_HOSTGATOR}}

      - name: ðŸ›© Run deployer!
        run: |
          php vendor/bin/envoy run deploy --env=dev

      - run: echo "ðŸ”Š Final Status ${{ job.status }}."
